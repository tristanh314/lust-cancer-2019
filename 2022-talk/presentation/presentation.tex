%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[
	11pt, % Set the default font size, options include: 8pt, 9pt, 10pt, 11pt, 12pt, 14pt, 17pt, 20pt
	%t, % Uncomment to vertically align all slide content to the top of the slide, rather than the default centered
	%aspectratio=169, % Uncomment to set the aspect ratio to a 16:9 ratio which matches the aspect ratio of 1080p and 4K screens and projectors
]{beamer}

\graphicspath{{Images/}{./}} % Specifies where to look for included images (trailing slash required)

\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule for better rules in tables

%----------------------------------------------------------------------------------------
%	SELECT LAYOUT THEME
%----------------------------------------------------------------------------------------

% Beamer comes with a number of default layout themes which change the colors and layouts of slides. Below is a list of all themes available, uncomment each in turn to see what they look like.

%\usetheme{default}
%\usetheme{AnnArbor}
%\usetheme{Antibes}
%\usetheme{Bergen}
%\usetheme{Berkeley}
%\usetheme{Berlin}
%\usetheme{Boadilla}
%\usetheme{CambridgeUS}
%\usetheme{Copenhagen}
%\usetheme{Darmstadt}
%\usetheme{Dresden}
%\usetheme{Frankfurt}
%\usetheme{Goettingen}
%\usetheme{Hannover}
%\usetheme{Ilmenau}
%\usetheme{JuanLesPins}
%\usetheme{Luebeck}
\usetheme{Madrid}
%\usetheme{Malmoe}
%\usetheme{Marburg}
%\usetheme{Montpellier}
%\usetheme{PaloAlto}
%\usetheme{Pittsburgh}
%\usetheme{Rochester}
%\usetheme{Singapore}
%\usetheme{Szeged}
%\usetheme{Warsaw}

%----------------------------------------------------------------------------------------
%	SELECT COLOR THEME
%----------------------------------------------------------------------------------------

% Beamer comes with a number of color themes that can be applied to any layout theme to change its colors. Uncomment each of these in turn to see how they change the colors of your selected layout theme.

%\usecolortheme{albatross}
%\usecolortheme{beaver}
%\usecolortheme{beetle}
%\usecolortheme{crane}
%\usecolortheme{dolphin}
%\usecolortheme{dove}
%\usecolortheme{fly}
%\usecolortheme{lily}
%\usecolortheme{monarca}
%\usecolortheme{seagull}
%\usecolortheme{seahorse}
%\usecolortheme{spruce}
%\usecolortheme{whale}
%\usecolortheme{wolverine}

%----------------------------------------------------------------------------------------
%	SELECT FONT THEME & FONTS
%----------------------------------------------------------------------------------------

% Beamer comes with several font themes to easily change the fonts used in various parts of the presentation. Review the comments beside each one to decide if you would like to use it. Note that additional options can be specified for several of these font themes, consult the beamer documentation for more information.

\usefonttheme{default} % Typeset using the default sans serif font
%\usefonttheme{serif} % Typeset using the default serif font (make sure a sans font isn't being set as the default font if you use this option!)
%\usefonttheme{structurebold} % Typeset important structure text (titles, headlines, footlines, sidebar, etc) in bold
%\usefonttheme{structureitalicserif} % Typeset important structure text (titles, headlines, footlines, sidebar, etc) in italic serif
%\usefonttheme{structuresmallcapsserif} % Typeset important structure text (titles, headlines, footlines, sidebar, etc) in small caps serif

%------------------------------------------------

%\usepackage{mathptmx} % Use the Times font for serif text
\usepackage{palatino} % Use the Palatino font for serif text

%\usepackage{helvet} % Use the Helvetica font for sans serif text
\usepackage[default]{opensans} % Use the Open Sans font for sans serif text
%\usepackage[default]{FiraSans} % Use the Fira Sans font for sans serif text
%\usepackage[default]{lato} % Use the Lato font for sans serif text

%----------------------------------------------------------------------------------------
%	SELECT INNER THEME
%----------------------------------------------------------------------------------------

% Inner themes change the styling of internal slide elements, for example: bullet points, blocks, bibliography entries, title pages, theorems, etc. Uncomment each theme in turn to see what changes it makes to your presentation.

%\useinnertheme{default}
\useinnertheme{circles}
%\useinnertheme{rectangles}
%\useinnertheme{rounded}
%\useinnertheme{inmargin}

%----------------------------------------------------------------------------------------
%	SELECT OUTER THEME
%----------------------------------------------------------------------------------------

% Outer themes change the overall layout of slides, such as: header and footer lines, sidebars and slide titles. Uncomment each theme in turn to see what changes it makes to your presentation.

%\useoutertheme{default}
%\useoutertheme{infolines}
%\useoutertheme{miniframes}
%\useoutertheme{smoothbars}
%\useoutertheme{sidebar}
%\useoutertheme{split}
%\useoutertheme{shadow}
%\useoutertheme{tree}
%\useoutertheme{smoothtree}

%\setbeamertemplate{footline} % Uncomment this line to remove the footer line in all slides
%\setbeamertemplate{footline}[page number] % Uncomment this line to replace the footer line in all slides with a simple slide count

%\setbeamertemplate{navigation symbols}{} % Uncomment this line to remove the navigation symbols from the bottom of all slides

%----------------------------------------------------------------------------------------
%	PRESENTATION INFORMATION
%----------------------------------------------------------------------------------------

\title[LUST 2019]{The Use of Lattice Upstream Targeting for the Analysis of mRNA Expression for Cancers} % The short title in the optional parameter appears at the bottom of every slide, the full title in the main parameter is only on the title page

\subtitle{LUST 2019} % Presentation subtitle, remove this command if a subtitle isn't required

\author[Holmes \and Nation et al]{Tristan Holmes \and J.B. Nation et al} % Presenter name(s), the optional parameter can contain a shortened version to appear on the bottom of every slide, while the main parameter will appear on the title slide

\institute[UH]{University of Hawaii at Manoa \\ \smallskip \textit{tristanh314@gmail.com}} % Your institution, the optional parameter can be used for the institution shorthand and will appear on the bottom of every slide after author names, while the required parameter is used on the title slide and can include your email address or additional information on separate lines

\date[\today]{PSU Systems Science Seminar\\ \today} % Presentation date or conference/meeting name, the optional parameter can contain a shortened version to appear on the bottom of every slide, while the required parameter value is output to the title slide

%----------------------------------------------------------------------------------------

\begin{document}

%----------------------------------------------------------------------------------------
%	TITLE SLIDE
%----------------------------------------------------------------------------------------

\begin{frame}
	\titlepage
\end{frame}

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS SLIDE
%----------------------------------------------------------------------------------------

% The table of contents outputs the sections and subsections that appear in your presentation, specified with the standard \section and \subsection commands. You may either display all sections and subsections on one slide with \tableofcontents, or display each section at a time on subsequent slides with \tableofcontents[pausesections]. The latter is useful if you want to step through each section and mention what you will discuss.

\begin{frame}
	\frametitle{Presentation Overview}
	
	\tableofcontents
\end{frame}

%----------------------------------------------------------------------------------------

\section{Introduction} 

%------------------------------------------------
\begin{frame}
	\frametitle{Abstract}
	
	In 2019 the UH Cancer Center hosted a project to identify genetic factors of interest in various types of cancer.
	
	\bigskip 

	One of the results of this effort was the use of the Lattice Upstream Targeting (LUST) Algorithm to analyze mRNA expression data for 33 different types of cancer in the TCGA database. This effort will be the topic of this presentation.
	
    \bigskip

    The full results of this effort can be found \href{https://github.com/tristanh314/lust-cancer-2019}{on GitHub}.

	\bigskip 

    Results of a similar project conducted using data proprietary to the UH cancer center led to studies seeking to identfy new chemical treatments.
\end{frame}

%------------------------------------------------
\begin{frame}
	\frametitle{Overview of Procedure}
	
	\begin{itemize}
        \item The LUST algorithm is a discrete mathematical method for analyzing continuous data, i.e., mRNA expression.
        \item For a given array of expression data, the algorithm is applied twice.
        \item 
        \begin{enumerate}
            \item The first run is on the entire expression matrix and uses a graph theoretic objective function to rank the groups obtained. This pass identifies and ranks a small set of \emph{metagenes} associated with the given cancer.
            \item The second run is on the expression matrix for each metagene and supervised by survival time as the objective function using the Fisher score to rank the results. This pass identifies small predictive \emph{signiatures} for each metagene.
        \end{enumerate}
        \item In some cases, certain signiatures would seem approprite to use as guides for treatment.
    \end{itemize}
\end{frame}

%----------------------------------------------------------------------------------------

\section{Data Setup}

%------------------------------------------------
\begin{frame}
	\frametitle{Data Aquisition and Cleaning}
	
	\begin{itemize}
        \item TCGA mRNA expression and clinical data are downloaded from the Broad Institute via the \href{https://gdac.broadinstitute.org/}{Firehose GDAC portal}.
        \item Normalized gene expression files sequenced by Illumina HiSeq are used, reporting expression levels for 20,531 genes.
        \item Samples from tissue surrounding tumors are removed so that each patient has a single record representing tumor tissue.
        \item The expression data is log transformed, quantile normalized, and row centered.
        \item Survival times and censoring information for each patient are contained in the clinical data and used later in the process.
    \end{itemize}
\end{frame}

%------------------------------------------------
\begin{frame}
	\frametitle{Data Discretization}
	
	\begin{itemize}
        \item The expression data is represented by a $20531 \times N$ real valued matrix $\mathbf{E}$, where $N$ is the number of samples.
        \item The matrix $\mathbf{E}$ is discretized into a $20531 \times N$ matrix $\mathbf{M}$ with entries in $\left\{ -1, 0, 1\right\}$.
        \item The desired density $D$ of non-zero entries in $\mathbf{M}$ is obtained by adjusting a threshold variable $\phi$ using the matrix secant method.
        \item For this study $D = 0.5$ for all cancers. In any particular study, one may seek to vary $D$ to optimize the results.
    \end{itemize}
\end{frame}

%----------------------------------------------------------------------------------------

\section{The Lattice Upstream Targeting Algorithm}

%------------------------------------------------
\begin{frame}
	\frametitle{Specifications}
	
	\begin{block}{}
        The LUST algorithm is used to find metagenes (\emph{Part I}), or signiatures (\emph{Part II}).
    \end{block}

    \begin{block}{Input}
        \begin{itemize}
            \item Discretized expression matrix $\mathbf{M}$.
            \item Parameters \emph{density}, \emph{conftol}, \emph{overlap} and \emph{noregs}.
            \item For Part II only, clinical data such as survival.
        \end{itemize}
    \end{block}

    \begin{block}{Output}
        \begin{itemize}
            \item Metagenes (Part I) or signiatures (Part II) ranked by an objective function.
            \item For Part II only, a score placing patients into high and low risk groups.
            \item For Part II only, Kaplan-Meyer survival curves.
        \end{itemize}
    \end{block}
\end{frame}

\begin{frame}
	\frametitle{Regulation and Equivalence}
    
    Assume the density $D$ has been fixed (0.5 in this study). We use \emph{conftol} (in this study 0.75 for Part I and either 0.66, 0.7, or 0.74 for Part II) to adjust sensitivity.
    
    \bigskip

    \begin{definition}
        For a gene $X$, let $X^{+}$ denote the number of columns marked with 1 and $x^{-}$ the number of columns marked with -1. We say $X$ \emph{regulates} $Y$, denoted $X \rightarrow Y$, if
        \begin{enumerate}
            \item $\frac{\left| X^{+} \cap Y^{+} \right|}{\left| X^{+} \right|} \geq conftol,\ \mathrm{and}$
            \item $\frac{\left| X^{-} \cap Y^{-} \right|}{\left| X^{-} \right|} \geq conftol.$
        \end{enumerate}
    \end{definition}

    \begin{definition}
        We say gene $X$ is \emph{eqvialent} to gene $Y$ and write $X \approx Y$ if $X \rightarrow Y$ and $Y \rightarrow X$.
    \end{definition}
\end{frame}

\begin{frame}
	\frametitle{Forming Groups}

    The algorithm begins by computing, for each gene $X$
    \begin{equation*}
        F_X := \left\{ Y : Y \approx X \right\}
    \end{equation*}

    \bigskip

    Note: $F_X$ is not necessarily and equilence class as $\approx$ is not transitive. Different groups merged if
    \begin{equation*}
        \frac{\left| F_X \cap F_Y \right|}{\min(\left| F_X \right|, \left| F_Y \right|)} \geq overlap
    \end{equation*}

    In this study, default values for \emph{overlap} were 0.5 for Part I and 0.6 for Part II. Merging was performed only once.
\end{frame}


\begin{frame}
    \frametitle{Refinement Using Upstream Regulators}

    Score every gene $X$ to measure it's effectiveness regulating the entire set of genes.
    \begin{equation*}
        s_X = \frac{1}{N} \cdot \sum_{X \rightarrow Y}\frac{\left( \left| X^{+} \cap Y^{+}\right| + \left| X^{-} \cap Y^{-}\right| \right)^2}{\left| X^{+} \right| + \left| X^{-} \right|}
    \end{equation*}
    Let $G$ be a group from the previous step. For each $X \notin G$, conisder
    \begin{equation*}
        G_X = \left\{ X \right\} \cup \left\{ Y \in G : X \rightarrow G \right\},
    \end{equation*}
    and assign a score
    \begin{equation*}
        p_{X,G}=\frac{\left| G_X \right|}{\left| G \right|}(1+s_X)
    \end{equation*}
    For $noregs=k$ (default 5), keep $G_{X_1}, \ldots, G_{X_k}$ with the $k$ highest scores $p_{X,G}$ for further analysis.
\end{frame}

\begin{frame}
    \frametitle{Objective Functions}
    \begin{block}{Part I}
        For a given metagene $M$ with $n$ genes, we consider $M$ as a directed graph with edges determined by $X \rightarrow Y$, and let $E$ be the set of edges of this graph.
        
        \smallskip
        
        We use a measure of the probability of obtaining a set of vertices of size $n$ with $\left| E \right|$ edges.
        \begin{equation*}
            f(M) = \frac{\left| E \right|}{n-1}
        \end{equation*}
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Objective Functions}
    \begin{block}{Part II}
        For each $G_X$ form a submatrix $\mathbf{E}_{G_X}$ from the undiscretized expression data.
        
        \smallskip
        
        Use eigen-survival analysis to produce a predictive score for each patient that is a linear combinatin of their expression values for $G_X$.

        \smallskip

        The top and bottom quartiles of the predictive scores are identified and used to calculate Kaplan-Meier expected surival curves.

        \smallskip

        Use the logrank and Cox tests to measure the separation of these two curves. Each test produces a $p$-value ($p_1$ and $p_2$, respectively). The \emph{Fisher score} combines these measures to rank how well the signiature separates the survival curves.
        \begin{equation*}
            F(G_X) = -\ln(p_1)-ln(p_2)
        \end{equation*}
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Fase Discovery Rates - Notation}

    Fix a density $D$, let $p=\frac{D}{2}$, and let $\gamma = conftol$. Consider an $m \times n$ matrix with entries from $\left\{ -1, 0, 1 \right\}$ assigned from uniform probability distributions with densities $p,\ p,\ 1-2p$.
    
    \smallskip

    \begin{block}{Probability row $X$ has $a$ entries $1$ and $b$ entries $-1$}
        \begin{equation*}
            g(n,a,b,p) = \binom{n}{a+b}p^{a+b}(1-2p)^{n-a-b}
        \end{equation*}        
    \end{block}

    \begin{block}{Probability row $Y$ has $c$ entries $1$ in $a$ columns}
        \begin{equation*}
            h(a,c,p) = \binom{n}{c}p^{c}(1-p)^{n-c}
        \end{equation*}        
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Fase Discovery Rates - Derivation}

    Fix a density $D$, let $p=\frac{D}{2}$, and let $\gamma = conftol$. Consider an $m \times n$ matrix with entries from $\left\{ -1, 0, 1 \right\}$ assigned from uniform probability distributions with densities $p,\ p,\ 1-2p$.
    
    \smallskip

    \begin{block}{Probability $X \rightarrow Y$}
        \begin{equation*}
            \sum_{1\leq a,b\leq n}g(n,a,b,p)\left( \sum_{a\geq c \geq \gamma a} h(a,c,p) \right)\left( \sum_{b\geq d \geq \gamma d} h(b,d,p) \right)
        \end{equation*}        
    \end{block}

    \begin{block}{Expected number of relations $X \rightarrow Y$}
        \begin{equation*}
            E = m(m-1) \cdot \mathrm{prob}(X \rightarrow Y)
        \end{equation*}        
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{False Discovery Rates - In Practice}

    Testing on permuted data matrices shows these estimates are quite accurate for values of $conftol$ used in this study.

    \bigskip

    The probability of random edges or used $conftol$ is very low, on the order of $10^{-5}$ at most.

    \bigskip

    The worst-case scenario in this study was cholangiocarcinoma, with only 36 patients. Here $E$ is about $9,220$, but the analysis found $830,000$ arrows.

    \bigskip

    For Part II, there are even fewer random arrows expected.
\end{frame}

\begin{frame}
    \frametitle{False Discovery Rates - In Practice}

    Testing on permuted data matrices shows these estimates are quite accurate for values of $conftol$ used in this study.

    \bigskip

    The probability of random edges or used $conftol$ is very low, on the order of $10^{-5}$ at most.

    \bigskip

    The worst-case scenario in this study was cholangiocarcinoma, with only 36 patients. Here $E$ is about $9,220$, but the analysis found $830,000$ arrows.

    \bigskip

    For Part II, there are even fewer random arrows expected.
\end{frame}

\begin{frame}
    \frametitle{Sensitivity - Simulations}

    To test the sensitiivty of LUST, simulations were run $5,000 \times 120$ signal matrix $\mathbf{S}$ with a step signal in the first 200 rows consisting of 30 enttries of $1$, 30 entries of $-1$, and 60 zeros.
    
    \bigskip

    A Gaussian noise matrix was made to create $\mathbf{M} = \mathbf{S} + a\mathbf{N}$, using $a$ to adjust signal-to-noise ratio.

    \bigskip

    Repeated tests were run at various levels of $conftol$. 

    \bigskip

    The conclusion was that the signals detected by Part I are quite strong.

\end{frame}

\begin{frame}
	\frametitle{Sensitivity - Results}
	\framesubtitle{Subtitle} % Optional subtitle
	
	\begin{table}
		\begin{tabular}{l l l}
			\toprule
			\textbf{SNR} & \textbf{Rows Found} & \textbf{False Positives}\\
			\midrule
			$-10db$ & 188 & 0 \\
			$-12.5db$ & 4 & 0 \\
			$-15db$ & 0 & 0 \\
			\bottomrule
		\end{tabular}
		\caption{$conftol$ = 0.7}
	\end{table}

    \begin{table}
		\begin{tabular}{l l l}
			\toprule
			\textbf{SNR} & \textbf{Rows Found} & \textbf{False Positives}\\
			\midrule
			$-10db$ & 200 & 0 \\
			$-12.5db$ & 196 & 0 \\
			$-15db$ & 50 & 0 \\
			\bottomrule
		\end{tabular}
		\caption{$conftol$ = 0.6}
	\end{table}
\end{frame}

\begin{frame}
	\frametitle{Sensitivity - More Results}
	\framesubtitle{Subtitle} % Optional subtitle
	
	\begin{table}
		\begin{tabular}{l l l}
			\toprule
			\textbf{SNR} & \textbf{Rows Found} & \textbf{False Positives}\\
			\midrule
			$-10db$ & 200 & 0 \\
			$-12.5db$ & 200 & 0 \\
			$-15db$ & 199 & 4 \\
			\bottomrule
		\end{tabular}
		\caption{$conftol$ = 0.5}
	\end{table}
\end{frame}

\end{document}